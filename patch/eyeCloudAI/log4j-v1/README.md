## 1. 패치 대상 모듈
1. agent
2. analyzer
3. collector
4. normalizer
5. procmonitor
6. proxy
7. searcher
8. sender
9. shovel_server
10. store
11. www (tomcat8)
12. etls
13. mlms
14. msms

## 2. 패치 대상 파일
1. 파일
- 기존 파일
   
|     | 기존파일         |                         |
|:----|:-------------|:------------------------|
| 1   | \*log4j*.jar | log4j 문자가 포함된 모든 jar 파일 |
| 2   | \*slf4j*.jar | slf4j 문자가 포함된 모든 jar 파일 |
 
- 패치 파일
    
|     | 패치파일                                     |                                                                                                                     |
|:----|:-----------------------------------------|:--------------------------------------------------------------------------------------------------------------------|
| 1   | log4j-1.2-api-2.16.0.jar                 | [다운로드](https://repo1.maven.org/maven2/org/apache/logging/log4j/log4j-1.2-api/2.16.0/log4j-1.2-api-2.16.0.jar)       |
| 2   | log4j-api-2.16.0.jar                     | [다운로드](https://repo1.maven.org/maven2/org/apache/logging/log4j/log4j-api/2.16.0/log4j-api-2.16.0.jar)               |
| 3   | log4j-core-2.16.0.jar                    | [다운로드](https://repo1.maven.org/maven2/org/apache/logging/log4j/log4j-core/2.16.0/log4j-core-2.16.0.jar)             |
| 4   | log4j-slf4j-impl-2.16.0.jar              | [다운로드](https://repo1.maven.org/maven2/org/apache/logging/log4j/log4j-slf4j-impl/2.16.0/log4j-slf4j-impl-2.16.0.jar) |
| 5   | slf4j-api-1.7.32.jar                     | [다운로드](https://repo1.maven.org/maven2/org/slf4j/slf4j-api/1.7.32/slf4j-api-1.7.32.jar)                              |
 | 6   | log4j.properties                         | [다운로드](conf/log4j.properties)                                                                                       |

2. 경로
- **위 기존파일을 삭제 또는 백업 후 패치파일을 아래 경로에 업로드 합니다.**

|     | 파일         | 경로                                                          |
|:----|:-----------|:------------------------------------------------------------|
| 1   | jar        | /eyeCloudAI/app/lib                                         |
| 2   | properties | /eyeCloudAI/app/**<span style="color:red">모듈명</span>**/conf |
| 3   | properties | /eyeCloudAI/app/www/ROOT/WEB-INF/conf                       |

## 3. 클래스 패스 수정
- vi 편집기를 이용해 각 모듈의 클래스패스(/eyeCloudAI/app/lib/lib_**<span style="color:red">모듈명</span>**)를 수정합니다.

```bash
$ vi /eyeCloudAI/app/lib/lib_agent
CLASSPATH=../lib/log4j-1.2.16.jar:..중략..:../lib/slf4j-api-1.7.12.jar:..
```

- vi 편집기를 이용해 톰캣의 클래스패스(/eyeCloudAI/app/tomcat8/conf/catalina.properties)를 수정 합니다.

```bash
$ vi /eyeCloudAI/app/tomcat8/conf/catalina.properties
..중략..
shared.loader="/eyeCloudAI/app/lib/activation-1.1.jar",..중략..,"/eyeCloudAI/app/lib/log4j-1.2.16.jar"..
..중략..
```

## 4. log4j 설정
1. log4j 설정파일을 로딩하기 위한 실행파일(/eyeCloudAI/app/**<span style="color:red">모듈명</span>**/**<span style="color:red">모듈명</span>**.sh, /eyeCloudAI/app/tomcat8/bin/catalina.sh)에 아래 아규멘트를 추가 합니다.
- **-Dlog4j.configurationFile=/CloudESM/app/**<span style="color:red">모듈명</span>**/conf/log4j.properties**
- JAVA_OPTS 변수가 있는 경우
  - JAVA_OPTS 변수 하단에 아래 설정값을 추가 합니다.
```bash
vi /eyeCloudAI/app/collector/collector.sh
..중략..
JAVA_OPTS="$JAVA_OPTS -Dlog4j.configurationFile=/CloudESM/app/collector/conf/log4j.properties"
..중략..
```
```bash
vi /eyeCloudAI/app/tomcat8/bin/catalina.sh
..중략..
JAVA_OPTS="$JAVA_OPTS -Dlog4j.configurationFile=/CloudESM/app/collector/conf/log4j.properties"
..중략..
```

- JAVA_OPTS 변수가 없는 경우
  - java 실행 명령줄에 직접 추가 합니다.
```bash
vi /eyeCloudAI/app/agent/agent.sh
..중략..
nohup $JAVA_HOME/bin/java -Dlog4j.configurationFile=/CloudESM/app/agent/conf/log4j.properties -Xms256m -Xmx512m ..중략..
..중략.. 
```

2. log4j 설정 파일
- log4j.properties 파일은 별도의 수정없이 첨부된 파일을 그대로 사용 합니다.
```bash
vi /eyeCloudAI/app/agent/conf/log4j.properties
# -Dlog4j.configurationFile=log4j.properties
status = info
name = default
monitorInterval = 0

# property
property.log-path = /eyeCloudAI/logs # 로그 저장 경로 설정
property.log-name = ${sys:APP}       # 실행 아규멘트(-DAPP=모듈명)에 설정된 명칭으로 로그 파일 생성 
property.log-pattern = %d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %c{1.}.%method:%line - %msg%n

..중략..

```

## 5. 모듈 재시작
- 각 모듈별 아래와 같이 실행 파일에 start 또는 stop 을 추가하여 실행 합니다.
```bash
./모듈명.sh stop
./모듈명.sh start 
```
- 예)
```bash
./agent.sh stop
./agent.sh start 
```